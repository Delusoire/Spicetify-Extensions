{
  "version": 3,
  "sources": ["../../extensions/bad-lyrics/app.ts", "../../shared/util.ts", "../../extensions/bad-lyrics/utils/PlayerW.ts", "../../extensions/star-ratings-2/util.ts", "../../shared/listeners.ts", "../../shared/deps.ts", "../../extensions/bad-lyrics/utils/LyricsProvider.ts", "../../extensions/bad-lyrics/utils/Song.ts", "../../extensions/bad-lyrics/components.ts", "../../extensions/bad-lyrics/pkgs/catmullRomSpline.ts"],
  "sourcesContent": ["import { render } from \"https://esm.sh/lit\"\r\n\r\nimport { PermanentMutationObserver } from \"../../shared/util.ts\"\r\n\r\nimport { PlayerW } from \"./utils/PlayerW.ts\"\r\nimport { LyricsContainer } from \"./components.ts\"\r\n\r\nnew PermanentMutationObserver(\"aside\", () => {\r\n    const lyricsContainer = document.querySelector<HTMLDivElement>(\".main-nowPlayingView-lyricsContent\")\r\n    if (!lyricsContainer || lyricsContainer.classList.contains(\"injected\")) return\r\n    lyricsContainer.classList.add(\"injected\")\r\n    const lyricsContainerClone = lyricsContainer.cloneNode(false) as typeof lyricsContainer\r\n    lyricsContainer.replaceWith(lyricsContainerClone)\r\n\r\n    const ourLyricsContainer = new LyricsContainer()\r\n    ourLyricsContainer.song = PlayerW.GetSong() ?? null\r\n    PlayerW.songChangedSubject.subscribe(song => (ourLyricsContainer.song = song ?? null))\r\n    PlayerW.scaledProgressChangedSubject.subscribe(progress => ourLyricsContainer.updateProgress(progress))\r\n    render(ourLyricsContainer, lyricsContainerClone)\r\n})\r\n", "export type SpotifyID = string\r\nexport type SpotifyURI = string\r\n\r\nconst { URI } = Spicetify\r\nconst { PlayerAPI } = Spicetify.Platform\r\n\r\nexport const SpotifyLoc = {\r\n    before: {\r\n        start: () => ({ before: \"start\" as const }),\r\n        fromUri: (uri: SpotifyURI) => ({ before: { uri } }),\r\n        fromUid: (uid: string) => ({ before: { uid } }),\r\n    },\r\n    after: {\r\n        end: () => ({ after: \"end\" as const }),\r\n        fromUri: (uri: SpotifyURI) => ({ after: { uri } }),\r\n        fromUid: (uid: string) => ({ after: { uid } }),\r\n    },\r\n}\r\n\r\nexport const normalizeStr = (str: string) =>\r\n    str\r\n        .normalize(\"NFKD\")\r\n        .replace(/\\(.*\\)/g, \"\")\r\n        .replace(/\\[.*\\]/g, \"\")\r\n        .replace(/-_,/g, \" \")\r\n        .replace(/[^a-zA-Z0-9 ]/g, \"\")\r\n        .replace(/\\s+/g, \" \")\r\n        .toLowerCase()\r\n        .trim()\r\n\r\nexport class PermanentMutationObserver extends MutationObserver {\r\n    target: HTMLElement | null = null\r\n\r\n    constructor(\r\n        targetSelector: string,\r\n        callback: MutationCallback,\r\n        opts: MutationObserverInit = {\r\n            childList: true,\r\n            subtree: true,\r\n        },\r\n    ) {\r\n        super(callback)\r\n        new MutationObserver(() => {\r\n            const nextTarget = document.querySelector<HTMLElement>(targetSelector)\r\n            if (nextTarget && !nextTarget.isEqualNode(this.target)) {\r\n                this.target && this.disconnect()\r\n                this.target = nextTarget\r\n                this.observe(this.target, opts)\r\n            }\r\n        }).observe(document.body, {\r\n            childList: true,\r\n            subtree: true,\r\n        })\r\n    }\r\n}\r\n\r\nexport const waitForElement = <E extends Element>(\r\n    selector: string,\r\n    timeout = 1000,\r\n    location = document.body,\r\n    notEl?: E | null,\r\n) =>\r\n    new Promise((resolve: (value: Element) => void, reject) => {\r\n        const onMutation = () => {\r\n            const el = document.querySelector<E>(selector)\r\n            if (el) {\r\n                if (notEl && el === notEl) {\r\n                } else {\r\n                    observer.disconnect()\r\n                    return resolve(el)\r\n                }\r\n            }\r\n        }\r\n\r\n        const observer = new MutationObserver(onMutation)\r\n        onMutation()\r\n\r\n        observer.observe(location, {\r\n            childList: true,\r\n            subtree: true,\r\n        })\r\n\r\n        if (timeout)\r\n            setTimeout(() => {\r\n                observer.disconnect()\r\n                reject()\r\n            }, timeout)\r\n    })\r\n\r\nexport const formatUri = (uri: string) => URI.fromString(uri).toURI()\r\n\r\nexport const sleep = (ms: number) => new Promise(resolve => setTimeout(resolve, ms))\r\n\r\nexport const mainElement = document.querySelector(\"main\")!\r\nexport const [REACT_FIBER, REACT_PROPS] = Object.keys(mainElement)\r\n\r\nexport const createQueueItem =\r\n    (queued: boolean) =>\r\n    ({ uri, uid = \"\" }: { uri: string; uid?: string }) => ({\r\n        contextTrack: {\r\n            uri,\r\n            uid,\r\n            metadata: {\r\n                is_queued: queued.toString(),\r\n            },\r\n        },\r\n        removed: [],\r\n        blocked: [],\r\n        provider: queued ? (\"queue\" as const) : (\"context\" as const),\r\n    })\r\n\r\nexport const setQueue = async (\r\n    nextTracks: Array<ReturnType<ReturnType<typeof createQueueItem>>>,\r\n    contextUri?: string,\r\n) => {\r\n    const { _queue, _client } = PlayerAPI._queue\r\n    const { prevTracks, queueRevision } = _queue\r\n\r\n    const res = await _client.setQueue({\r\n        nextTracks,\r\n        prevTracks,\r\n        queueRevision,\r\n    })\r\n\r\n    await PlayerAPI.skipToNext()\r\n\r\n    if (contextUri) {\r\n        await new Promise<void>(resolve => {\r\n            PlayerAPI._events.addListener(\"queue_update\", () => resolve(), { once: true })\r\n        })\r\n        await setPlayingContext(contextUri)\r\n    }\r\n\r\n    return res\r\n}\r\n\r\nexport const setPlayingContext = (uri: string) => {\r\n    const { sessionId } = PlayerAPI._state\r\n    return PlayerAPI.updateContext(sessionId, { uri, url: \"context://\" + uri })\r\n}\r\n", "import { Subject, animationFrameScheduler, asyncScheduler } from \"https://esm.sh/rxjs\"\r\n\r\nimport { onPlayedPaused, onSongChanged } from \"../../../shared/listeners.ts\"\r\n\r\nimport { Song } from \"./Song.ts\"\r\n\r\nconst { PlayerAPI } = Spicetify.Platform\r\n\r\nexport const PlayerW = new (class {\r\n    private Song?: Song\r\n    isPaused = PlayerAPI._state.isPaused\r\n    scaledProgress = 0\r\n\r\n    songChangedSubject = new Subject<Song | void>()\r\n    isPausedChangedSubject = new Subject<boolean>()\r\n    scaledProgressChangedSubject = new Subject<number>()\r\n\r\n    GetSong = () => this.Song\r\n\r\n    constructor() {\r\n        onSongChanged(state => {\r\n            const { item } = state\r\n\r\n            if (item && item.type === \"track\") {\r\n                const uri = item.uri\r\n                const name = item.name\r\n                const artist = item.metadata.artist_name\r\n                const album = item.album.name\r\n                const duration = item.duration.milliseconds\r\n                const isPaused = state.isPaused\r\n                const metadata = item.metadata\r\n                this.Song = new Song({ uri, name, artist, album, duration, isPaused, metadata })\r\n            } else {\r\n                this.Song = undefined\r\n            }\r\n\r\n            this.songChangedSubject.next(this.Song)\r\n        })\r\n\r\n        onPlayedPaused(state => {\r\n            const isPausedNext = state.isPaused ?? true\r\n            if (this.isPaused !== isPausedNext) {\r\n                if (!isPausedNext) {\r\n                    this.startTimestepping()\r\n                }\r\n                this.isPaused = !this.isPaused\r\n                this.isPausedChangedSubject.next(this.isPaused)\r\n            }\r\n        })\r\n    }\r\n\r\n    private triggerTimestampSync() {\r\n        let autoSyncs = 0\r\n\r\n        const timeoutFn = () => 1000 * autoSyncs++\r\n\r\n        asyncScheduler.schedule(\r\n            function (self) {\r\n                if (self!.isPaused) return\r\n\r\n                if (!PlayerAPI._events.emitResumeSync()) {\r\n                    PlayerAPI._contextPlayer.resume({})\r\n                }\r\n\r\n                this.schedule(self, timeoutFn())\r\n            },\r\n            timeoutFn(),\r\n            this,\r\n        )\r\n    }\r\n\r\n    private startTimestepping() {\r\n        let oldScaledProgress = Spicetify.Player.getProgressPercent()\r\n        animationFrameScheduler.schedule(\r\n            function (self) {\r\n                if (self!.isPaused) return\r\n\r\n                self!.scaledProgress = Spicetify.Player.getProgressPercent()\r\n                if (self!.scaledProgress !== oldScaledProgress) {\r\n                    self!.scaledProgressChangedSubject.next(self!.scaledProgress)\r\n                }\r\n                oldScaledProgress = self!.scaledProgress\r\n                this.schedule(self)\r\n            },\r\n            undefined,\r\n            this,\r\n        )\r\n\r\n        this.triggerTimestampSync()\r\n    }\r\n})()\r\n", "import { REACT_PROPS } from \"../../shared/util.ts\"\r\n\r\nexport const RATINGS_FOLDER_NAME = \"Ratings\"\r\n\r\nexport const getTrackLists = () =>\r\n    Array.from(document.querySelectorAll<HTMLDivElement>(\".main-trackList-trackList.main-trackList-indexable\"))\r\nexport const getTrackListTracks = (trackList: HTMLDivElement) =>\r\n    Array.from(trackList.querySelectorAll<HTMLDivElement>(\".main-trackList-trackListRow\"))\r\n\r\nexport const getTrackListTrackUri = (track: HTMLDivElement) => {\r\n    const rowSectionEnd = track.querySelector<HTMLDivElement>(\".main-trackList-rowSectionEnd\")!\r\n    const reactProps = rowSectionEnd[REACT_PROPS]\r\n    const { props } =\r\n        // artist & local tracks & albums\r\n        reactProps.children.at?.(-1).props.menu ??\r\n        // playlists\r\n        reactProps.children.props.children.at(-1).props.menu\r\n\r\n    return props.uri\r\n}\r\n\r\nexport const getNowPlayingBar = () => document.querySelector<HTMLDivElement>(\"div.main-nowPlayingBar-nowPlayingBar\")!\r\nexport const getCollectionActionBarRow = () => document.querySelector<HTMLDivElement>(`div.main-actionBar-ActionBarRow`)\r\n\r\nexport const playlistButtonSelector = `button[aria-label=\"Add to Liked Songs\"], button[aria-label=\"Add to playlist\"], button[aria-label=\"Remove recommendation\"]`\r\nexport const getPlaylistButton = (parent: HTMLElement) =>\r\n    parent.querySelector<HTMLButtonElement>(playlistButtonSelector)!\r\nexport const getCollectionPlaylistButton = () => {\r\n    const ab = getCollectionActionBarRow()\r\n    return ab?.querySelector<HTMLButtonElement>(\r\n        `button[aria-label=\"Remove from Your Library\"], button[aria-label=\"Save to Your Library\"]`,\r\n    )\r\n}\r\n", "import { getTrackListTracks, getTrackLists } from \"../extensions/star-ratings-2/util.ts\"\r\n\r\nimport { PermanentMutationObserver, REACT_FIBER } from \"./util.ts\"\r\n\r\nconst { Player, URI } = Spicetify\r\nconst { PlayerAPI, History } = Spicetify.Platform\r\n\r\nexport const onHistoryChanged = (\r\n    toMatchTo: string | RegExp | ((location: string) => boolean),\r\n    callback: (uri: string) => void,\r\n    dropDuplicates = true,\r\n) => {\r\n    const createMatchFn = (toMatchTo: string | RegExp | ((input: string) => boolean)) => {\r\n        switch (typeof toMatchTo) {\r\n            case \"string\":\r\n                return (input: string) => input?.startsWith(toMatchTo) ?? false\r\n\r\n            case \"function\":\r\n                return toMatchTo\r\n\r\n            default:\r\n                return (input: string) => toMatchTo.test(input)\r\n        }\r\n    }\r\n\r\n    let lastPathname = \"\"\r\n    const matchFn = createMatchFn(toMatchTo)\r\n\r\n    const historyChanged = ({ pathname }: any) => {\r\n        if (matchFn(pathname)) {\r\n            if (dropDuplicates && lastPathname === pathname) {\r\n            } else callback(URI.fromString(pathname).toURI())\r\n        }\r\n        lastPathname = pathname\r\n    }\r\n\r\n    historyChanged(History.location ?? {})\r\n    return History.listen(historyChanged)\r\n}\r\n\r\nexport const onSongChanged = (callback: (state: Spicetify.Platform.PlayerAPI.PlayerState) => void) => {\r\n    callback(PlayerAPI._state)\r\n    Player.addEventListener(\"songchange\", event => callback(event!.data))\r\n}\r\n\r\nexport const onPlayedPaused = (callback: (state: Spicetify.Platform.PlayerAPI.PlayerState) => void) => {\r\n    callback(PlayerAPI._state)\r\n    Player.addEventListener(\"onplaypause\", event => callback(event!.data))\r\n}\r\n\r\ntype TrackListElement = HTMLDivElement & { presentation?: HTMLDivElement }\r\ntype TrackElement = HTMLDivElement & { props?: Record<string, any> }\r\n\r\ntype TrackListMutationListener = (trackList: Required<TrackListElement>, tracks: Array<Required<TrackElement>>) => void\r\nexport const onTrackListMutationListeners = new Array<TrackListMutationListener>()\r\n\r\nconst _onTrackListMutation = (\r\n    trackList: Required<TrackListElement>,\r\n    record: MutationRecord[],\r\n    observer: MutationObserver,\r\n) => {\r\n    const tracks = getTrackListTracks(trackList.presentation) as Array<Required<TrackElement>>\r\n\r\n    const reactFiber = trackList.presentation[REACT_FIBER].alternate\r\n    const reactTracks = reactFiber.pendingProps.children as any[]\r\n    const tracksProps = reactTracks.map((child: any) => child.props as Record<string, any>)\r\n\r\n    tracks.forEach((track, i) => (track.props = tracksProps[i]))\r\n\r\n    const fullyRenderedTracks = tracks.filter(track => track.props.uri)\r\n\r\n    onTrackListMutationListeners.map(listener => listener(trackList, fullyRenderedTracks))\r\n}\r\n\r\nnew PermanentMutationObserver(\"main\", () => {\r\n    const trackLists = getTrackLists() as Array<TrackListElement>\r\n    trackLists\r\n        .filter(trackList => !trackList.presentation)\r\n        .forEach(trackList => {\r\n            trackList.presentation = trackList.lastElementChild!.firstElementChild!\r\n                .nextElementSibling! as HTMLDivElement\r\n\r\n            new MutationObserver((record, observer) =>\r\n                _onTrackListMutation(trackList as Required<TrackListElement>, record, observer),\r\n            ).observe(trackList.presentation, { childList: true })\r\n        })\r\n})\r\n", "// @deno-types=\"npm:@types/lodash\"\r\nimport { default as ld } from \"https://esm.sh/lodash\"\r\nexport const _ = ld\r\n\r\n// @deno-types=\"npm:@types/lodash/fp\"\r\nimport { default as ld_fp } from \"https://esm.sh/lodash/fp\"\r\nexport const fp = ld_fp\r\n", "import { _ } from \"../../../shared/deps.ts\"\r\n\r\nconst headers = {\r\n    authority: \"apic-desktop.musixmatch.com\",\r\n    cookie: \"x-mxm-token-guid=\",\r\n}\r\n\r\nconst CONFIG = {\r\n    musixmatchToken: undefined as unknown as string,\r\n}\r\n\r\n// if (!CONFIG.musixmatchToken) {\r\nconst url = new URL(\"https://apic-desktop.musixmatch.com/ws/1.1/token.get\")\r\nurl.searchParams.append(\"app_id\", \"web-desktop-app-v1.0\")\r\nSpicetify.CosmosAsync.get(url.toString(), undefined, _.omit(headers, \"cookie\")).then(res => {\r\n    if (res.message.header.status_code === 200 && res.message.body.user_token) {\r\n        CONFIG.musixmatchToken = res.message.body.user_token\r\n    }\r\n})\r\n// }\r\n\r\nexport type Lyrics = {\r\n    notSynced?: NotSynced\r\n    lineSynced?: LineSynced\r\n    wordSynced?: WordSynced\r\n}\r\n\r\nexport type SyncedContent = {\r\n    tss: number\r\n    tes: number\r\n    content: Array<SyncedContent> | string\r\n}\r\n\r\nexport type Synced<A> = {\r\n    tss: number\r\n    tes: number\r\n    content: A\r\n}\r\n\r\nexport type SyncedFiller = Synced<typeof Filler> & {\r\n    duration: number\r\n}\r\n\r\nexport enum LyricsType {\r\n    NONE,\r\n    NOT_SYNCED,\r\n    LINE_SYNCED,\r\n    WORD_SYNCED,\r\n}\r\n\r\nexport const Filler = \"\u266A\"\r\n\r\nexport type NotSynced = Synced<string> & { __type: LyricsType.NOT_SYNCED }\r\nexport type LineSynced = Synced<Array<Synced<readonly [Synced<string>]>>> & { __type: LyricsType.LINE_SYNCED }\r\nexport type WordSynced = Synced<Array<Synced<Array<Synced<string>>> | SyncedFiller>> & {\r\n    __type: LyricsType.WORD_SYNCED\r\n}\r\n\r\nexport const flattenLyrics = (lyrics: SyncedContent): Array<Synced<string> | SyncedFiller> =>\r\n    Array.isArray(lyrics.content) ? lyrics.content.flatMap(flattenLyrics) : [lyrics as Synced<string> | SyncedFiller]\r\n\r\nexport const findLyrics = async (info: {\r\n    uri: string\r\n    title: string\r\n    artist: string\r\n    album: string\r\n    durationS: number\r\n}) => {\r\n    const { lyrics, subtitles, track } = await fetchMxmMacroSubtitlesGet(\r\n        info.uri,\r\n        info.title,\r\n        info.artist,\r\n        info.album,\r\n        info.durationS,\r\n    )\r\n\r\n    const l: Lyrics = {}\r\n    if (!lyrics) return l\r\n\r\n    const wrapInContainerSyncedType = <T extends LyricsType, P>(__type: T, content: P) => ({\r\n        __type,\r\n        tss: 0,\r\n        tes: 1,\r\n        content,\r\n    })\r\n\r\n    if (track.has_richsync) {\r\n        const richSync = await fetchMxmTrackRichSyncGet(track.commontrack_id, track.track_length)\r\n        const wordSynced = richSync.map(rsLine => {\r\n            const tss = rsLine.ts / track.track_length\r\n            const tes = rsLine.te / track.track_length\r\n\r\n            const content = rsLine.l.map((word, index, words) => {\r\n                return {\r\n                    tss: tss + word.o / track.track_length,\r\n                    tes: tss + words[index + 1]?.o / track.track_length || tes,\r\n                    content: word.c,\r\n                }\r\n            })\r\n\r\n            return { tss, tes, content }\r\n        })\r\n\r\n        const wordSyncedFilled = wordSynced.flatMap((rsLine, i, wordSynced) => {\r\n            const nextRsLine = wordSynced[i + 1]\r\n            const tss = rsLine.tes\r\n            const tes = nextRsLine?.tss\r\n            const dr = tes - tss\r\n            if (!dr) return rsLine\r\n\r\n            return [\r\n                rsLine,\r\n                {\r\n                    tss,\r\n                    tes,\r\n                    duration: dr * track.track_length * 1000,\r\n                    content: Filler,\r\n                } as SyncedFiller,\r\n            ]\r\n        })\r\n\r\n        l.wordSynced = wrapInContainerSyncedType(LyricsType.WORD_SYNCED, wordSyncedFilled)\r\n    }\r\n\r\n    if (track.has_subtitles) {\r\n        const subtitle = JSON.parse(subtitles[0].subtitle_body) as Array<{\r\n            text: string\r\n            time: { total: number; minutes: number; seconds: number; hundredths: number }\r\n        }>\r\n        const lineSynced = subtitle.map((sLine, i, subtitle) => {\r\n            const tss = sLine.time.total / track.track_length\r\n            const tes = subtitle[i + 1]?.time.total / track.track_length || 1\r\n            return { tss, tes, content: [{ tss, tes, content: sLine.text }] as const }\r\n        })\r\n        l.lineSynced = wrapInContainerSyncedType(LyricsType.LINE_SYNCED, lineSynced)\r\n    }\r\n\r\n    if (track.has_lyrics || track.has_lyrics_crowd) {\r\n        l.notSynced = wrapInContainerSyncedType(LyricsType.NOT_SYNCED, lyrics.lyrics_body)\r\n    }\r\n\r\n    return l\r\n}\r\n\r\nconst getTranslation = async (trackId: string, lang = \"en\") => {\r\n    const res = await fetchMxmCrowdTrackTranslationsGet(trackId, lang)\r\n    return res.map(translation => ({\r\n        translation: translation.description,\r\n        matchedLine: translation.matched_line,\r\n    }))\r\n}\r\n\r\ntype MusicGenreList = Array<{\r\n    music_genre: {\r\n        music_genre_id: number\r\n        music_genre_parent_id: number\r\n        music_genre_name: string\r\n        music_genre_name_extended: string\r\n        music_genre_vanity: string\r\n    }\r\n}>\r\ntype MxMLyrics = {\r\n    lyrics_id: number\r\n    can_edit: 0 | 1\r\n    locked: 0 | 1\r\n    published_status: 0 | 1\r\n    action_requested: string\r\n    verified: 0 | 1\r\n    restricted: 0 | 1\r\n    instrumental: 0 | 1\r\n    explicit: 0 | 1\r\n    lyrics_body: string\r\n    lyrics_language: string\r\n    lyrics_language_description: string\r\n    script_tracking_url: string\r\n    pixel_tracking_url: string\r\n    html_tracking_url: string\r\n    lyrics_copyright: string\r\n    writer_list: string[]\r\n    publisher_list: string[]\r\n    backlink_url: string\r\n    updated_time: string\r\n}\r\ntype MxMSnippet = {\r\n    snippet_id: number\r\n    snippet_language: string\r\n    restricted: 0 | 1\r\n    instrumental: 0 | 1\r\n    snippet_body: string\r\n    script_tracking_url: string\r\n    pixel_tracking_url: string\r\n    html_tracking_url: string\r\n    updated_time: string\r\n}\r\ntype MxMSubtitle = {\r\n    subtitle_id: number\r\n    restricted: 0 | 1\r\n    published_status: number\r\n    subtitle_body: string\r\n    subtitle_avg_count: number\r\n    lyrics_copyright: string\r\n    subtitle_length: number\r\n    subtitle_language: string\r\n    subtitle_language_description: string\r\n    script_tracking_url: string\r\n    pixel_tracking_url: string\r\n    html_tracking_url: string\r\n    writer_list: string[]\r\n    publisher_list: string[]\r\n    updated_time: string\r\n}\r\ntype MxMTrack = {\r\n    track_id: number\r\n    track_mbid: string\r\n    track_isrc: string\r\n    commontrack_isrcs: Array<string[]>\r\n    track_spotify_id: string\r\n    commontrack_spotify_ids: string[]\r\n    commontrack_itunes_ids: number[]\r\n    track_soundcloud_id: number\r\n    track_xboxmusic_id: string\r\n    track_name: string\r\n    track_name_translation_list: any[]\r\n    track_rating: number\r\n    track_length: number\r\n    commontrack_id: number\r\n    instrumental: 0 | 1\r\n    explicit: 0 | 1\r\n    has_lyrics: 0 | 1\r\n    has_lyrics_crowd: 0 | 1\r\n    has_subtitles: 0 | 1\r\n    has_richsync: 0 | 1\r\n    has_track_structure: 0 | 1\r\n    num_favorite: number\r\n    lyrics_id: number\r\n    subtitle_id: number\r\n    album_id: number\r\n    album_name: string\r\n    album_vanity_id: string\r\n    artist_id: number\r\n    artist_mbid: string\r\n    artist_name: string\r\n    album_coverart_100x100: string\r\n    album_coverart_350x350: string\r\n    album_coverart_500x500: string\r\n    album_coverart_800x800: string\r\n    track_share_url: string\r\n    track_edit_url: string\r\n    commontrack_vanity_id: string\r\n    restricted: 0 | 1\r\n    first_release_date: string\r\n    updated_time: string\r\n    primary_genres: {\r\n        music_genre_list: MusicGenreList\r\n    }\r\n    secondary_genres: {\r\n        music_genre_list: MusicGenreList\r\n    }\r\n}\r\ntype MxMMacroSubtitles = {\r\n    lyrics: MxMLyrics\r\n    snippet: MxMSnippet\r\n    subtitles: Array<MxMSubtitle>\r\n    track: MxMTrack\r\n}\r\ntype None<A> = { [k in keyof A]: undefined }\r\nconst fetchMxmMacroSubtitlesGet = async (\r\n    uri: string,\r\n    title: string,\r\n    artist: string,\r\n    album: string,\r\n    durationS: number,\r\n    renewsLeft = 1,\r\n): Promise<MxMMacroSubtitles | None<MxMMacroSubtitles>> => {\r\n    const url = new URL(\"https://apic-desktop.musixmatch.com/ws/1.1/macro.subtitles.get\")\r\n    url.searchParams.append(\"format\", \"json\")\r\n    url.searchParams.append(\"namespace\", \"lyrics_richsynched\")\r\n    url.searchParams.append(\"subtitle_format\", \"mxm\")\r\n    url.searchParams.append(\"app_id\", \"web-desktop-app-v1.0\")\r\n    url.searchParams.append(\"q_album\", album)\r\n    url.searchParams.append(\"q_artist\", artist)\r\n    url.searchParams.append(\"q_artists\", artist)\r\n    url.searchParams.append(\"q_track\", title)\r\n    url.searchParams.append(\"track_spotify_id\", uri)\r\n    url.searchParams.append(\"q_duration\", encodeURIComponent(durationS))\r\n    url.searchParams.append(\"f_subtitle_length\", encodeURIComponent(Math.floor(durationS)))\r\n    url.searchParams.append(\"usertoken\", CONFIG.musixmatchToken)\r\n\r\n    const res = await Spicetify.CosmosAsync.get(url.toString(), undefined, headers)\r\n    if (res.message.header.hint === \"renew\") {\r\n        return renewsLeft > 0\r\n            ? fetchMxmMacroSubtitlesGet(uri, title, artist, album, durationS, 0)\r\n            : Promise.resolve({} as None<MxMMacroSubtitles>)\r\n    }\r\n    const {\r\n        \"track.lyrics.get\": trackLyricsGet,\r\n        \"track.snippet.get\": trackSnippetGet,\r\n        \"track.subtitles.get\": trackSubtitlesGet,\r\n        \"userblob.get\": userblobGet,\r\n        \"matcher.track.get\": matcherTrackGet,\r\n    } = res.message.body.macro_calls\r\n    return {\r\n        lyrics: trackLyricsGet.message.body.lyrics as MxMLyrics,\r\n        snippet: trackSnippetGet.message.body.snippet as MxMSnippet,\r\n        subtitles: trackSubtitlesGet.message.body.subtitle_list.map(\r\n            (subtitle_element: any) => subtitle_element.subtitle,\r\n        ) as Array<MxMSubtitle>,\r\n        track: matcherTrackGet.message.body.track as MxMTrack,\r\n    }\r\n}\r\n\r\nconst fetchMxmTrackRichSyncGet = async (commonTrackId: number, trackLength: number) => {\r\n    const url = new URL(\"https://apic-desktop.musixmatch.com/ws/1.1/track.richsync.get\")\r\n    url.searchParams.append(\"format\", \"json\")\r\n    url.searchParams.append(\"subtitle_format\", \"mxm\")\r\n    url.searchParams.append(\"app_id\", \"web-desktop-app-v1.0\")\r\n    url.searchParams.append(\"f_subtitle_length\", encodeURIComponent(trackLength))\r\n    url.searchParams.append(\"q_duration\", encodeURIComponent(trackLength))\r\n    url.searchParams.append(\"commontrack_id\", encodeURIComponent(commonTrackId))\r\n    url.searchParams.append(\"usertoken\", CONFIG.musixmatchToken)\r\n\r\n    const res = await Spicetify.CosmosAsync.get(url.toString(), undefined, headers)\r\n\r\n    return JSON.parse(res.message.body.richsync.richsync_body) as Array<{\r\n        ts: number\r\n        te: number\r\n        l: Array<{\r\n            c: string\r\n            o: number\r\n        }>\r\n        x: string\r\n    }>\r\n}\r\n\r\nconst fetchMxmCrowdTrackTranslationsGet = async (trackId: string, lang = \"en\") => {\r\n    const url = new URL(\"https://apic-desktop.musixmatch.com/ws/1.1/crowd.track.translations.get\")\r\n    url.searchParams.append(\"translation_fields_set\", \"minimal\")\r\n    url.searchParams.append(\"selected_language\", lang)\r\n    url.searchParams.append(\"comment_format\", \"text\")\r\n    url.searchParams.append(\"format\", \"json\")\r\n    url.searchParams.append(\"app_id\", \"web-desktop-app-v1.0\")\r\n    url.searchParams.append(\"track_id\", trackId)\r\n    url.searchParams.append(\"usertoken\", CONFIG.musixmatchToken)\r\n\r\n    const res = await Spicetify.CosmosAsync.get(url.toString(), undefined, headers)\r\n\r\n    return res.message.body.translations_list.map(\r\n        (translation_element: any) => translation_element.translation,\r\n    ) as Array<any>\r\n}\r\n", "import { Track } from \"https://esm.sh/v135/@fostertheweb/spotify-web-api-ts-sdk@1.2.1/dist/mjs/types.js\"\r\nimport { Lyrics, findLyrics } from \"./LyricsProvider.ts\"\r\n\r\nexport type SpotifyTrackInformation = Track\r\n\r\nexport class Song {\r\n    readonly uri: string\r\n    readonly name: string\r\n    readonly artist: string\r\n    readonly album: string\r\n    readonly duration: number\r\n    readonly isLocal: boolean\r\n    readonly lyrics: Promise<Lyrics>\r\n\r\n    isPaused: boolean\r\n    private timestamp = 0\r\n\r\n    constructor(opts: {\r\n        uri: string\r\n        name: string\r\n        artist: string\r\n        album: string\r\n        duration: number\r\n        isPaused: boolean\r\n        metadata: Spicetify.Platform.PlayerAPI.TrackMetadata\r\n    }) {\r\n        this.uri = opts.uri\r\n        this.name = opts.name\r\n        this.artist = opts.artist\r\n        this.album = opts.album\r\n        this.duration = opts.duration\r\n        this.isLocal = opts.metadata.is_local === \"true\"\r\n        this.isPaused = opts.isPaused\r\n\r\n        this.lyrics = findLyrics({\r\n            uri: this.uri,\r\n            title: this.name,\r\n            artist: this.artist,\r\n            album: this.album,\r\n            durationS: this.duration / 1000,\r\n        })\r\n    }\r\n\r\n    getTimestamp = () => this.timestamp\r\n\r\n    setTimestamp = (timestampMs: number) => Spicetify.Player.seek(timestampMs)\r\n}\r\n", "import { consume, createContext, provide } from \"https://esm.sh/@lit/context\"\r\nimport { Task } from \"https://esm.sh/@lit/task\"\r\n// import { hermite } from \"https://esm.sh/@thi.ng/ramp\"\r\nimport { LitElement, css, html } from \"https://esm.sh/lit\"\r\nimport { customElement, property, query, queryAll, state } from \"https://esm.sh/lit/decorators.js\"\r\nimport { map } from \"https://esm.sh/lit/directives/map.js\"\r\nimport { PropertyValueMap } from \"https://esm.sh/v133/@lit/reactive-element@2.0.1/development/reactive-element.js\"\r\n\r\nimport { _ } from \"../../shared/deps.ts\"\r\nimport { CatmullRollSpline, remapScalar, vectorWithTime } from \"./pkgs/catmullRomSpline.ts\"\r\nimport { Filler, LyricsType, SyncedContent, SyncedFiller } from \"./utils/LyricsProvider.ts\"\r\nimport { PlayerW } from \"./utils/PlayerW.ts\"\r\nimport { Song } from \"./utils/Song.ts\"\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        [\"lyrics-container\"]: LyricsContainer\r\n        [\"animated-content-container\"]: AnimatedContentContainer\r\n        [\"animated-content\"]: AnimatedContent\r\n        [\"animated-filler\"]: AnimatedFiller\r\n    }\r\n}\r\n\r\n// const createInterpolator = (...stops: number[][]) => {\r\n//     const spline = hermite(stops)\r\n//     return (t: number) => spline.at(t)\r\n// }\r\n\r\nconst scrollTimeoutCtx = createContext<number>(\"scrollTimeout\")\r\nconst spotifyContainerCtx = createContext<HTMLElement | undefined>(\"spotifyContainer\")\r\nconst loadedLyricsTypeCtx = createContext<LyricsType>(\"loadedLyricsType\")\r\n\r\n@customElement(AnimatedContentContainer.NAME)\r\nexport class AnimatedContentContainer extends LitElement {\r\n    static readonly NAME = \"animated-content-container\" as const\r\n\r\n    static styles = css`\r\n        :host {\r\n            /* border: 0;\r\n            background-color: transparent; */\r\n        }\r\n    `\r\n\r\n    @property({ type: Array })\r\n    content = new Array<SyncedContent>()\r\n    @property({ type: Number })\r\n    tss = 0\r\n    @property({ type: Number })\r\n    tes = 1\r\n\r\n    @queryAll(\"*:not(br)\")\r\n    // @ts-expect-error only has a getter\r\n    childs: NodeListOf<AnimatedContentContainer | AnimatedContent | AnimatedFiller>\r\n\r\n    updateProgress(rsp: number, index: number, depthToActiveAncestor: number) {\r\n        const childs = Array.from(this.childs)\r\n        const partialWidths = childs.reduce(\r\n            (partialWidths, child) => [...partialWidths, partialWidths.at(-1)! + child.offsetWidth],\r\n            [0],\r\n        )\r\n        const totalWidth = partialWidths.at(-1)!\r\n        const points = childs\r\n            .map((child, i) => [child.tss, [partialWidths[i] / totalWidth]] as vectorWithTime)\r\n            .concat([[childs.at(-1)!.tes, [1]]])\r\n        const sharedProgressSpline = CatmullRollSpline.fromPointsClamped(points)!\r\n        childs.forEach((child, i) => {\r\n            let progress =\r\n                child instanceof AnimatedContentContainer\r\n                    ? rsp\r\n                    : remapScalar(partialWidths[i], partialWidths[i + 1], sharedProgressSpline.at(rsp)[0])\r\n            index = child.updateProgress(\r\n                progress,\r\n                index,\r\n                depthToActiveAncestor + Number(!_.inRange(rsp, child.tss, child.tes)),\r\n            )\r\n        })\r\n\r\n        return index\r\n    }\r\n\r\n    render() {\r\n        return html`${map(this.content, part => {\r\n                if (Array.isArray(part.content)) {\r\n                    return html`<animated-content-container .content=${part.content} tss=${part.tss} tes=${part.tes} />`\r\n                }\r\n\r\n                if (part.content === Filler) {\r\n                    const filler = part as SyncedFiller\r\n                    return html`<animated-filler\r\n                        content=${filler.content}\r\n                        tss=${filler.tss}\r\n                        tes=${filler.tes}\r\n                        duration=${filler.duration}\r\n                    />`\r\n                }\r\n\r\n                return html` <animated-content content=${part.content} tss=${part.tss} tes=${part.tes} />`\r\n            })}<br />`\r\n    }\r\n}\r\n\r\nexport abstract class SyncedScrolledContent extends LitElement {\r\n    @property()\r\n    content = \"\"\r\n    @property({ type: Number })\r\n    tss = 0\r\n    @property({ type: Number })\r\n    tes = 1\r\n\r\n    @consume({ context: scrollTimeoutCtx, subscribe: true })\r\n    scrollTimeout = 0\r\n    @consume({ context: spotifyContainerCtx })\r\n    spotifyContainer?: HTMLElement\r\n\r\n    updateProgress(scaledProgress: number, index: number, depthToActiveAncestor: number) {\r\n        const isActive = depthToActiveAncestor === 0\r\n\r\n        if (isActive) {\r\n            if (Date.now() > this.scrollTimeout && this.spotifyContainer) {\r\n                const lineHeightHeuristic = this.offsetHeight\r\n                const scrollTop = this.offsetTop - this.spotifyContainer.offsetTop - lineHeightHeuristic\r\n                const verticalLinesToActive =\r\n                    Math.abs(scrollTop - this.spotifyContainer.scrollTop) / this.spotifyContainer.offsetHeight\r\n\r\n                if (_.inRange(verticalLinesToActive, 0.1, 0.75)) {\r\n                    this.spotifyContainer.scrollTo({\r\n                        top: scrollTop,\r\n                        behavior: \"smooth\",\r\n                    })\r\n                }\r\n            }\r\n        }\r\n\r\n        const csp = _.clamp(scaledProgress, -0.5, 1.5)\r\n        this.animateContent(csp, depthToActiveAncestor)\r\n\r\n        return index + 1\r\n    }\r\n\r\n    abstract animateContent(scaledProgress: number, depthToActiveAncestor: number): void\r\n}\r\n\r\n@customElement(AnimatedFiller.NAME)\r\nexport class AnimatedFiller extends SyncedScrolledContent {\r\n    static readonly NAME = \"animated-filler\" as const\r\n\r\n    static styles = css`\r\n        :host {\r\n            cursor: pointer;\r\n            background-color: black;\r\n            -webkit-text-fill-color: transparent;\r\n            -webkit-background-clip: text;\r\n        }\r\n    `\r\n\r\n    // // @ts-expect-error gets initialized in firstUpdated\r\n    // gradientAlphaSpring: Spring\r\n\r\n    @property({ type: Number })\r\n    duration = 0\r\n\r\n    private springsInitialized = false\r\n\r\n    private tryInitializeSprings(scaledProgress: number) {\r\n        if (this.springsInitialized) return\r\n        // this.gradientAlphaSpring = new Spring(0, 1, 1, scaledProgress)\r\n        this.springsInitialized = true\r\n    }\r\n\r\n    animateContent(scaledProgress: number, depthToActiveAncestor: number) {\r\n        this.tryInitializeSprings(scaledProgress)\r\n        // this.gradientAlphaSpring.setEquilibrium(0.9 ** (1 + depthToActiveAncestor))\r\n        // const gradientAlpha = this.gradientAlphaSpring.compute(scaledProgress)\r\n        // if (!this.gradientAlphaSpring.isInEquilibrium()) {\r\n        this.style.setProperty(\"--gradient-alpha\", scaledProgress.toFixed(2))\r\n        // }\r\n\r\n        this.style.backgroundImage = `linear-gradient(var(--gradient-angle), rgba(255,255,255,var(--gradient-alpha)) ${\r\n            scaledProgress * 100\r\n        }%, rgba(255,255,255,0) ${scaledProgress * 110}%)`\r\n    }\r\n\r\n    render() {\r\n        if (this.duration < LyricsContainer.MINIMUM_FILL_DURATION_MS) return\r\n        return html`\r\n            <span role=\"button\" @click=${() => PlayerW.GetSong()?.setTimestamp(this.tss)}>${this.content}</span><br />\r\n        `\r\n    }\r\n}\r\n\r\n@customElement(AnimatedContent.NAME)\r\nexport class AnimatedContent extends SyncedScrolledContent {\r\n    static readonly NAME = \"animated-content\" as const\r\n\r\n    static styles = css`\r\n        :host {\r\n            cursor: pointer;\r\n            background-color: black;\r\n            -webkit-text-fill-color: transparent;\r\n            -webkit-background-clip: text;\r\n        }\r\n    `\r\n\r\n    // // @ts-expect-error gets initialized in firstUpdated\r\n    // gradientAlphaSpring: Spring\r\n\r\n    @consume({ context: loadedLyricsTypeCtx })\r\n    loadedLyricsType = LyricsType.NONE\r\n\r\n    private springsInitialized = false\r\n\r\n    private tryInitializeSprings(scaledProgress: number) {\r\n        if (this.springsInitialized) return\r\n        // this.gradientAlphaSpring = new Spring(0, 1, 1, scaledProgress)\r\n        this.springsInitialized = true\r\n    }\r\n\r\n    animateContent(scaledProgress: number, depthToActiveAncestor: number) {\r\n        this.tryInitializeSprings(scaledProgress)\r\n        // this.gradientAlphaSpring.setEquilibrium(0.9 ** (1 + depthToActiveAncestor))\r\n        // const gradientAlpha = this.gradientAlphaSpring.compute(scaledProgress)\r\n        // if (!this.gradientAlphaSpring.isInEquilibrium()) {\r\n        this.style.setProperty(\"--gradient-alpha\", scaledProgress.toFixed(2))\r\n        // }\r\n\r\n        this.style.backgroundImage = `linear-gradient(var(--gradient-angle), rgba(255,255,255,var(--gradient-alpha)) ${\r\n            scaledProgress * 100\r\n        }%, rgba(255,255,255,0) ${scaledProgress * 110}%)`\r\n    }\r\n\r\n    render() {\r\n        return html`<span role=\"button\" @click=${() => PlayerW.GetSong()?.setTimestamp(this.tss)}\r\n            >${this.content}</span\r\n        >`\r\n    }\r\n}\r\n\r\n@customElement(LyricsContainer.NAME)\r\nexport class LyricsContainer extends LitElement {\r\n    static readonly NAME = \"lyrics-container\" as const\r\n\r\n    static readonly MINIMUM_FILL_DURATION_MS = 300\r\n    static readonly SCROLL_TIMEOUT_MS = 500\r\n\r\n    static styles = css`\r\n        :host > animated-content-container {\r\n            display: unset;\r\n        }\r\n    `\r\n\r\n    @property({ attribute: false })\r\n    song: Song | null = null\r\n\r\n    @provide({ context: loadedLyricsTypeCtx })\r\n    @state()\r\n    loadedLyricsType = LyricsType.NONE\r\n\r\n    private updateSong = (song: Song | null) => {\r\n        this.song = song\r\n        this.loadedLyricsType = LyricsType.NONE\r\n    }\r\n\r\n    private lyricsTask = new Task(this, {\r\n        task: async ([song]) => {\r\n            const availableLyrics = await song?.lyrics\r\n            const lyrics = Object.values(availableLyrics!)[0]\r\n            this.loadedLyricsType = lyrics ? lyrics.__type : LyricsType.NONE\r\n            return lyrics\r\n        },\r\n        args: () => [this.song],\r\n    })\r\n\r\n    public updateProgress(progress: number) {\r\n        if (this.loadedLyricsType === LyricsType.NONE || this.loadedLyricsType === LyricsType.NOT_SYNCED) return\r\n        this.firstContainer.updateProgress(progress, 0, 0)\r\n    }\r\n\r\n    @query(AnimatedContentContainer.NAME)\r\n    // @ts-expect-error only has a getter\r\n    firstContainer: AnimatedContentContainer\r\n\r\n    @provide({ context: scrollTimeoutCtx })\r\n    scrollTimeout = 0\r\n\r\n    @provide({ context: spotifyContainerCtx })\r\n    spotifyContainer =\r\n        document.querySelector<HTMLElement>(\"aside div.main-nowPlayingView-lyricsContent.injected\") ?? undefined\r\n\r\n    firstUpdated(changedProperties: PropertyValueMap<this>) {\r\n        this.spotifyContainer?.addEventListener(\"scroll\", e => {\r\n            this.scrollTimeout = Date.now() + LyricsContainer.SCROLL_TIMEOUT_MS\r\n        })\r\n    }\r\n\r\n    render() {\r\n        return this.song\r\n            ? this.lyricsTask.render({\r\n                  pending: () => {\r\n                      return html`<div class=\"fetching\">Fetching Lyrics...</div>`\r\n                  },\r\n                  complete: lyrics => {\r\n                      if (!lyrics) {\r\n                          return html`<div class=\"noLyrics\">No Lyrics Found</div>`\r\n                      }\r\n                      const isWordSynced = this.loadedLyricsType === LyricsType.WORD_SYNCED\r\n\r\n                      const style = [\r\n                          [\"--gradient-angle\", `${isWordSynced ? 90 : 180}deg`],\r\n                          [\"--animated-text-bg-color\", isWordSynced ? \"black\" : \"white\"],\r\n                          [\"\"],\r\n                      ]\r\n                          .map(a => a.join(\": \"))\r\n                          .join(\"; \")\r\n\r\n                      return html`\r\n                          <animated-content-container\r\n                              style=${style}\r\n                              .content=${lyrics.content}\r\n                          ></animated-content-container>\r\n                      `\r\n                  },\r\n                  error: e => {\r\n                      console.error(e)\r\n                      return html`<div class=\"error\">Error</div>`\r\n                  },\r\n              })\r\n            : html`<div class=\"error\">No Song Loaded</div>`\r\n    }\r\n}\r\n", "import { _ } from \"../../../shared/deps.ts\"\r\n\r\n// https://en.wikipedia.org/wiki/Centripetal_Catmull%E2%80%93Rom_spline\r\n\r\ntype vector = readonly number[]\r\nexport type vectorWithTime = readonly [number, vector]\r\n\r\nconst scalarLerp = (s: number, e: number, t: number) => s + (e - s) * t\r\nconst vectorLerp = (u: vector, v: vector, t: number) => _.zip(u, v).map(([xiu, xiv]) => scalarLerp(xiu!, xiv!, t))\r\nexport const remapScalar = (s: number, e: number, x: number) => (x - s) / (e - s)\r\n\r\nconst slidingWindow = <E>(array: E[], slidingWindowSize: number) =>\r\n    _.range(slidingWindowSize, array.length + 1).map(i => array.slice(i - slidingWindowSize, i))\r\n\r\ntype Quadruplet<A> = readonly [A, A, A, A]\r\ntype PointQuadruplet = Quadruplet<vector>\r\ntype TimeQuadruplet = Quadruplet<number>\r\nexport type PointInTimeQuadruplet = Quadruplet<vectorWithTime>\r\nclass CatmullRomCurve {\r\n    private P\r\n    private T\r\n\r\n    constructor(points: PointInTimeQuadruplet) {\r\n        ;[this.T, this.P] = _.unzip(points) as unknown as [TimeQuadruplet, PointQuadruplet]\r\n    }\r\n\r\n    at(t: number) {\r\n        t = _.clamp(t, this.T[1], this.T[2])\r\n        const vectorLerpWithRemapedScalar = (s: vectorWithTime, e: vectorWithTime, x: number) =>\r\n            vectorLerp(s[1], e[1], remapScalar(s[0], e[0], x))\r\n\r\n        const A = [\r\n            vectorLerpWithRemapedScalar([this.T[0], this.P[0]], [this.T[1], this.P[1]], t),\r\n            vectorLerpWithRemapedScalar([this.T[1], this.P[1]], [this.T[2], this.P[2]], t),\r\n            vectorLerpWithRemapedScalar([this.T[2], this.P[2]], [this.T[3], this.P[3]], t),\r\n        ]\r\n        const B = [\r\n            vectorLerpWithRemapedScalar([this.T[0], A[0]], [this.T[2], A[1]], t),\r\n            vectorLerpWithRemapedScalar([this.T[1], A[1]], [this.T[3], A[2]], t),\r\n        ]\r\n        return vectorLerpWithRemapedScalar([this.T[1], B[0]], [this.T[2], B[1]], t)\r\n    }\r\n}\r\n\r\nexport class CatmullRollSpline {\r\n    private points\r\n    private catnumRollCurves\r\n\r\n    private constructor(points: Array<vectorWithTime>) {\r\n        this.points = _.sortBy(points, p => p[0])\r\n        this.catnumRollCurves = slidingWindow(this.points, 4).map(\r\n            P => new CatmullRomCurve(P as unknown as PointInTimeQuadruplet),\r\n        )\r\n    }\r\n\r\n    at(t: number) {\r\n        const point = [t, []] as vectorWithTime\r\n        const i = _.clamp(_.sortedLastIndexBy(this.points, point, p => p[0]) - 2, 0, this.catnumRollCurves.length - 1)\r\n        return this.catnumRollCurves[i].at(t)\r\n    }\r\n\r\n    static fromPoints(points: Array<vectorWithTime>) {\r\n        if (points.length < 4) return null\r\n\r\n        return new CatmullRollSpline(points)\r\n    }\r\n\r\n    static fromPointsClamped(points: Array<vectorWithTime>) {\r\n        if (points.length < 2) return null\r\n\r\n        const [P1, P2] = _.take(points, 2)\r\n        const [P3, P4] = _.takeRight(points, 2)\r\n        const P0 = [scalarLerp(P1[0], P2[0], -1), vectorLerp(P1[1], P2[1], -1)] as const\r\n        const P5 = [scalarLerp(P3[0], P4[0], 2), vectorLerp(P3[1], P4[1], 2)] as const\r\n\r\n        return this.fromPoints([P0, ...points, P5])\r\n    }\r\n}\r\n\r\nfunction deCasteljau(points: vector[], position: number) {\r\n    if (points.length < 2) return points[0]\r\n    return deCasteljau(\r\n        slidingWindow(points, 2).map(([Pi, Pj]) => vectorLerp(Pi, Pj, position)),\r\n        position,\r\n    )\r\n}\r\n"],
  "mappings": "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",
  "names": ["URI", "PlayerAPI", "PlayerAPI", "wordSynced", "subtitle", "url", "PlayerAPI", "state", "partialWidths"]
}
